# Game Rooms - å‰åç«¯åˆ†ç¦»ç‰ˆæœ¬

è¿™æ˜¯ tiaoom æ¸¸æˆé¡¹ç›®çš„å‰åç«¯åˆ†ç¦»é‡æ„ç‰ˆæœ¬ï¼Œå°†åŸæœ‰çš„ Express + EJS + Vue CDN æ¶æ„æ”¹é€ ä¸ºç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚

## æŠ€æœ¯æ ˆ

### åç«¯
- **Express** - Node.js Web æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **WebSocket** - å®æ—¶é€šä¿¡
- **Express Session** - ä¼šè¯ç®¡ç†
- **CORS** - è·¨åŸŸæ”¯æŒ

### å‰ç«¯
- **Vue 3** - æ¸è¿›å¼ JavaScript æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **Vite** - å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·
- **TailwindCSS** - å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶
- **Pinia** - çŠ¶æ€ç®¡ç†
- **Vue Router** - è·¯ç”±ç®¡ç†
- **ReconnectingWebSocket** - WebSocket è‡ªåŠ¨é‡è¿

## é¡¹ç›®ç»“æ„

```
game_new/
â”œâ”€â”€ package.json          # æ ¹é¡¹ç›®é…ç½®ï¼ˆnpm workspaceï¼‰
â”œâ”€â”€ backend/              # åç«¯æœåŠ¡å™¨
â”‚   â”œâ”€â”€ src/             # æºä»£ç ï¼ˆä»åŸé¡¹ç›®å¤åˆ¶ï¼‰
â”‚   â”œâ”€â”€ games/           # æ¸¸æˆé€»è¾‘ï¼ˆä»åŸé¡¹ç›®å¤åˆ¶ï¼‰
â”‚   â”œâ”€â”€ sessions/        # ä¼šè¯å­˜å‚¨ï¼ˆä»åŸé¡¹ç›®å¤åˆ¶ï¼‰
â”‚   â”œâ”€â”€ index.ts         # åç«¯å…¥å£
â”‚   â”œâ”€â”€ package.json     # åç«¯ä¾èµ–
â”‚   â””â”€â”€ tsconfig.json
â””â”€â”€ frontend/            # å‰ç«¯åº”ç”¨
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ api/              # API è¯·æ±‚
    â”‚   â”œâ”€â”€ components/       # Vue ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ games/       # æ¸¸æˆç»„ä»¶
    â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒæ¸¸æˆé€»è¾‘
    â”‚   â”œâ”€â”€ stores/          # Pinia çŠ¶æ€ç®¡ç†
    â”‚   â”œâ”€â”€ types/           # TypeScript ç±»å‹
    â”‚   â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
    â”‚   â”œâ”€â”€ router/          # è·¯ç”±é…ç½®
    â”‚   â””â”€â”€ main.ts          # å…¥å£æ–‡ä»¶
    â”œâ”€â”€ package.json
    â”œâ”€â”€ vite.config.ts
    â””â”€â”€ tailwind.config.js
```

## ä¾èµ–ç®¡ç†

æœ¬é¡¹ç›®ä½¿ç”¨ **npm workspace** ç®¡ç† monorepoï¼š

- å…¬å…±ä¾èµ–ï¼ˆå¦‚ TypeScriptã€@types/nodeï¼‰åœ¨æ ¹ç›®å½•ç®¡ç†
- å„å­åŒ…ä¿æŒç‹¬ç«‹çš„ dependencies
- ä½¿ç”¨ `npm install` ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ä¾èµ–
- ä½¿ç”¨ `npm run <script> --workspace=<package>` æ“ä½œç‰¹å®šåŒ…

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

ä½¿ç”¨ npm workspace ç»Ÿä¸€ç®¡ç†ä¾èµ–ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£…æ‰€æœ‰ä¾èµ–
cd game_new
npm install
```

### å¼€å‘æ¨¡å¼

```bash
# æ–¹å¼1: åŒæ—¶å¯åŠ¨å‰åç«¯ï¼ˆæ¨èï¼‰
npm run dev

# æ–¹å¼2: åˆ†åˆ«å¯åŠ¨
npm run dev:backend    # ä»…å¯åŠ¨åç«¯
npm run dev:frontend   # ä»…å¯åŠ¨å‰ç«¯
```

- åç«¯ API: http://127.0.0.1:27016
- å‰ç«¯åº”ç”¨: http://localhost:5173
- WebSocket: ws://127.0.0.1:27016

### ç”Ÿäº§æ„å»º

```bash
# æ„å»ºå‰åç«¯
npm run build

# æˆ–åˆ†åˆ«æ„å»º
npm run build:backend
npm run build:frontend
```

## ä¸»è¦å˜æ›´

### æ¶æ„å˜æ›´

1. **å‰åç«¯åˆ†ç¦»**
   - åç«¯ä¸“æ³¨äº API å’Œ WebSocket æœåŠ¡
   - å‰ç«¯ä½¿ç”¨ Vue 3 + Vite ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²

2. **ç§»é™¤æœåŠ¡ç«¯æ¸²æŸ“**
   - ä¸å†ä½¿ç”¨ EJS æ¨¡æ¿
   - å‰ç«¯å®Œå…¨ç”± Vue ç»„ä»¶æ„å»º

3. **ç°ä»£åŒ–æ„å»ºå·¥å…·**
   - ä½¿ç”¨ Vite æ›¿ä»£ç›´æ¥å¼•å…¥ Vue CDN
   - æ”¯æŒ TypeScriptã€çƒ­æ›´æ–°ã€æ¨¡å—åŒ–

4. **æ ·å¼é‡æ„**
   - ä½¿ç”¨ TailwindCSS æ›¿ä»£æ‰‹å†™ CSS
   - ä¿æŒåŸæœ‰è®¾è®¡é£æ ¼

### API å˜æ›´

åç«¯æ–°å¢çš„ API ç«¯ç‚¹ï¼š

- `GET /api/config` - è·å–é…ç½®ï¼ˆWebSocket åœ°å€ã€æ¸¸æˆåˆ—è¡¨ï¼‰
- `GET /api/session` - è·å–å½“å‰ä¼šè¯
- `POST /api/login` - ç”¨æˆ·ç™»å½•
- `POST /api/logout` - ç”¨æˆ·ç™»å‡º
- åŸæœ‰çš„ API ç«¯ç‚¹ä¿æŒä¸å˜

### åŠŸèƒ½ä¿æŒ

âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼š
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- æ‘¸é±¼æ´¾ç™»å½•
- åˆ›å»º/åŠ å…¥/ç¦»å¼€æˆ¿é—´
- æˆ¿é—´èŠå¤©å’Œå…¨å±€èŠå¤©
- æ¸¸æˆå‡†å¤‡å’Œå¼€å§‹
- å®æ—¶ç©å®¶åˆ—è¡¨å’Œæˆ¿é—´åˆ—è¡¨
- WebSocket å®æ—¶é€šä¿¡

### æ¸¸æˆç»„ä»¶

- âœ… **Othello (é»‘ç™½æ£‹)** - å·²å®Œæˆ
- ğŸš§ **Gobang (äº”å­æ£‹)** - å¾…å®ç°
- ğŸš§ **Connect4 (å››å­æ£‹)** - å¾…å®ç°
- ğŸš§ **Spy (è°æ˜¯å§åº•)** - å¾…å®ç°

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ¸¸æˆ

1. åœ¨ `frontend/src/components/{game}/` åˆ›å»ºæ¸¸æˆç»„ä»¶
2. åœ¨ `frontend/src/components/index.ts` æ³¨å†Œç»„ä»¶
3. åç«¯æ¸¸æˆé€»è¾‘ä¿æŒåœ¨ `backend/games/` ä¸­

### ç¯å¢ƒé…ç½®

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

**åç«¯** (`backend/.env`):
```
PORT=27016
```

**å‰ç«¯** (`frontend/.env`):
```
VITE_API_URL=http://127.0.0.1:27016
```

## éƒ¨ç½²å»ºè®®

1. **åç«¯éƒ¨ç½²**
   - æ„å»ºåç«¯: `cd backend && pnpm build`
   - ä½¿ç”¨ PM2 æˆ–ç±»ä¼¼å·¥å…·è¿è¡Œ: `pm2 start dist/index.js`

2. **å‰ç«¯éƒ¨ç½²**
   - æ„å»ºå‰ç«¯: `cd frontend && pnpm build`
   - å°† `dist` ç›®å½•éƒ¨ç½²åˆ°é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ˆNginxã€CDNç­‰ï¼‰

3. **åå‘ä»£ç†**
   - ä½¿ç”¨ Nginx å°†å‰ç«¯é™æ€æ–‡ä»¶å’Œåç«¯ API ç»Ÿä¸€ä»£ç†

ç¤ºä¾‹ Nginx é…ç½®ï¼š
```nginx
server {
    listen 80;
    
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://127.0.0.1:27016;
    }
    
    location /ws {
        proxy_pass http://127.0.0.1:27016;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## æ³¨æ„äº‹é¡¹

1. å‰åç«¯éœ€è¦åˆ†åˆ«è¿è¡Œåœ¨ä¸åŒç«¯å£
2. å¼€å‘æ—¶å‰ç«¯ä¼šè‡ªåŠ¨ä»£ç† `/api` è¯·æ±‚åˆ°åç«¯
3. WebSocket åœ°å€ä»åç«¯é…ç½® API è·å–
4. ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½® CORS å…è®¸çš„æº

## è®¸å¯è¯

ä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´
